{"version":3,"sources":["./node_modules/@arcgis/core/views/2d/engine/flow/FlowDisplayObject.js","./node_modules/@arcgis/core/views/2d/engine/flow/FlowContainer.js","./node_modules/@arcgis/core/views/2d/engine/imagery/RasterVFDisplayObject.js","./node_modules/@arcgis/core/views/2d/engine/flow/flowRendererUtils.js","./node_modules/@arcgis/core/views/2d/engine/flow/FlowStrategy.js","./node_modules/@arcgis/core/views/2d/engine/flow/FlowDisplayData.js","./node_modules/@arcgis/core/views/2d/engine/flow/FlowView2D.js","./node_modules/@arcgis/core/views/2d/engine/flow/FlowStyle.js","./node_modules/@arcgis/core/views/layers/support/popupUtils.js","./node_modules/@arcgis/core/views/2d/engine/flow/FlowGLResources.js"],"names":[],"mappings":"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","file":"default~layers-ImageryLayerView2D-js~layers-ImageryTileLayerView2D-js.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{deg2rad as t}from\"../../../../core/mathUtils.js\";import{isSome as s,isNone as a}from\"../../../../core/maybe.js\";import{l as e,d as i,c as r,r as o}from\"../../../../chunks/mat3.js\";import{c as n}from\"../../../../chunks/mat3f32.js\";import{DisplayObject as l}from\"../DisplayObject.js\";class m extends l{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(t){this._displayData=t,this.requestRender()}clear(){s(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())}setTransform(s){const{displayData:n}=this;if(a(n))return;const l=n.extent.xmin,m=n.extent.ymax,p=[0,0];s.toScreen(p,[l,m]);const c=(n.extent.xmax-n.extent.xmin)/n.size[0]/s.resolution,d=t(s.rotation),{dvs:x}=this.transforms;e(x,[-1,1,0]),i(x,x,[2/(s.size[0]*s.pixelRatio),-2/(s.size[1]*s.pixelRatio),1]),r(x,x,[p[0],p[1],0]),o(x,x,d),i(x,x,[c*s.pixelRatio,c*s.pixelRatio,1])}_createTransforms(){return{dvs:n()}}}export{m as FlowDisplayObject};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"./BrushFlow.js\";import{WGLDrawPhase as r}from\"../webgl/enums.js\";import s from\"../webgl/WGLContainer.js\";class t extends s{constructor(){super(...arguments),this.flowStyle=null}get requiresDedicatedFBO(){return!1}doRender(e){super.doRender(e)}prepareRenderPasses(s){const t=s.registerRenderPass({name:\"flow\",brushes:[e],target:()=>this.children,drawPhase:r.MAP});return[...super.prepareRenderPasses(s),t]}}export{t as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{isSome as t}from\"../../../../core/maybe.js\";import{b as e,c as s,r as a,j as r,m as i}from\"../../../../chunks/mat3.js\";import{c as o}from\"../../../../chunks/mat3f32.js\";import{f as n}from\"../../../../chunks/vec2f32.js\";import{createVFMesh as l,createVFMeshScalar as c}from\"../../../../layers/support/rasterFunctions/vectorFieldUtils.js\";import{DisplayObject as h}from\"../DisplayObject.js\";import{createProgramDescriptor as m}from\"../webgl/Utils.js\";import{BufferObject as u}from\"../../../webgl/BufferObject.js\";import{Usage as d,DataType as v}from\"../../../webgl/enums.js\";import{VertexArrayObject as f}from\"../../../webgl/VertexArrayObject.js\";class _ extends h{constructor(t=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.width=null,this.source=t}destroy(){var e,s;t(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(s=this.vaoData.scalar)||s.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(t){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(t)&&(this._symbolizerParameters=t,this.invalidateVAO())}get source(){return this._source}set source(t){this._source=t,this.invalidateVAO()}invalidateVAO(){var e,s;!this._vaoInvalidated&&t(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(s=this.vaoData.scalar)||s.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,t(this.source)&&!t(this.vaoData)){const{style:t}=this.symbolizerParameters;switch(t){case\"beaufort_ft\":case\"beaufort_km\":case\"beaufort_kn\":case\"beaufort_m\":case\"beaufort_mi\":case\"classified_arrow\":case\"ocean_current_kn\":case\"ocean_current_m\":case\"single_arrow\":{const t=l(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:s}}break;case\"simple_scalar\":{const t=c(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,t);this.vaoData={scalar:s}}break;case\"wind_speed\":{const t=l(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,t),a=c(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,a);this.vaoData={magdir:s,scalar:r}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:o()}}setTransform(t){const o=e(this.transforms.dvs),[l,c]=t.toScreenNoRotation([0,0],[this.x,this.y]),h=this.resolution/this.pixelRatio/t.resolution,m=h*this.width,u=h*this.height,d=Math.PI*this.rotation/180;s(o,o,n(l,c)),s(o,o,n(m/2,u/2)),a(o,o,-d),s(o,o,n(-m/2,-u/2)),r(o,o,n(m,u)),i(this.transforms.dvs,t.displayViewMat3,o)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(t,e){const{vertexData:s,indexData:a}=e,r=u.createVertex(t,d.STATIC_DRAW,new Float32Array(s)),i=u.createIndex(t,d.STATIC_DRAW,new Uint32Array(a)),o=m(\"vector-field\",{geometry:[{location:0,name:\"a_pos\",count:2,type:v.FLOAT,normalized:!1},{location:1,name:\"a_offset\",count:2,type:v.FLOAT,normalized:!1},{location:2,name:\"a_vv\",count:2,type:v.FLOAT,normalized:!1}]});return{vao:new f(t,o.attributes,o.bufferLayouts,{geometry:r},i),elementCount:a.length}}}export{_ as RasterVFDisplayObject};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{pt2px as e}from\"../../../../core/screenUtils.js\";function t(t){const o=s(t),r=n(o),l=2*r,u=Math.round(e(t.maxPathLength)/l)+1,p=r,c=10,h=i(t),f=a(t),{flowSpeed:d,trailLength:g,density:m}=t;return{lineRenderWidth:o,segmentLength:l,verticesPerLine:u,lineCollisionWidth:p,lineSpacing:c,lineColor:h,lineOpacity:f,lineSpeed:d,fadeDuration:g,density:m,smoothing:e(t.smoothing),velocityScale:\"flow-from\"===t.flowRepresentation?1:-1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}}function n(e){return\"constant\"===e.kind?e.value[0]:e.values[e.values.length-1]}function o(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function s(t){if(!t.hasVisualVariables(\"size\"))return{kind:\"constant\",value:[e(t.trailWidth)]};const n=t.getVisualVariablesForType(\"size\")[0],o=[],s=[];let i;if(n.stops){for(const e of n.stops)o.push(e.value),s.push(e.size);i=n.stops.length}else o.push(n.minDataValue,n.maxDataValue),s.push(n.minSize,n.maxSize),i=2;return{kind:\"ramp\",stops:o,values:s,count:i}}function i(e){if(!e.hasVisualVariables(\"color\"))return{kind:\"constant\",value:o(e.color)};const t=e.getVisualVariablesForType(\"color\")[0],n=[],s=[];for(const i of t.stops)n.push(i.value),Array.prototype.push.apply(s,o(i.color));return{kind:\"ramp\",stops:n,values:s,count:t.stops.length}}function a(e){if(!e.hasVisualVariables(\"opacity\"))return{kind:\"constant\",value:[1]};const t=e.getVisualVariablesForType(\"opacity\")[0],n=[],o=[];for(const s of t.stops)n.push(s.value),o.push(s.opacity);return{kind:\"ramp\",stops:n,values:o,count:t.stops.length}}export{t as createFlowRendererSettings};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import o from\"../../../../core/Accessor.js\";import e from\"../../../../core/Logger.js\";import{deg2rad as i}from\"../../../../core/mathUtils.js\";import{isNone as r,isSome as s}from\"../../../../core/maybe.js\";import{isAbortError as a}from\"../../../../core/promiseUtils.js\";import{property as l}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import p from\"../../../../geometry/Point.js\";import c from\"./FlowDisplayData.js\";import{FlowDisplayObject as m}from\"./FlowDisplayObject.js\";import d from\"../../../../geometry/Extent.js\";const y=1.15,h=e.getLogger(\"esri.views.2d.engine.flow.FlowStrategy\");let f=class extends o{constructor(t){super(t),this._flowDisplayObject=new m,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(t){const{flowStyle:o}=this.flowContainer;if(r(o))return void this._clear();const{extent:e,rotation:i,resolution:l,pixelRatio:n}=t.state,p=g(e,i);p.expand(y);const m=[Math.round((p.xmax-p.xmin)/l),Math.round((p.ymax-p.ymin)/l)],d=new c(o,p,m,n);if(s(this._loading)){if(this._loading.update(d))return;this._loading.destroy(),this._loading=null}!r(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(d)||(d.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(t=>{a(t)||(h.error(\"A resource failed to load.\",t),this._loading=null)})),this._loading=d)}_clear(){this._flowDisplayObject.clear(),s(this._loading)&&(this._loading.destroy(),this._loading=null)}};t([l()],f.prototype,\"_loading\",void 0),t([l()],f.prototype,\"flowContainer\",void 0),t([l()],f.prototype,\"updating\",null),f=t([n(\"esri.views.2d.engine.flow.FlowStrategy\")],f);const u=f;function g(t,o){const e=new p({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference}),r=t.xmax-t.xmin,s=t.ymax-t.ymin,a=Math.abs(Math.cos(i(o))),l=Math.abs(Math.sin(i(o))),n=a*r+l*s,c=l*r+a*s,m=new d({xmin:e.x-n/2,ymin:e.y-c/2,xmax:e.x+n/2,ymax:e.y+c/2,spatialReference:t.spatialReference});return m.centerAt(e),m}export{u as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Logger.js\";const t=e.getLogger(\"esri.views.2d.engine.flow.FlowDisplayData\");class s{constructor(e,t,s,a){this.state={name:\"created\"},this.flowStyle=e,this.extent=t,this.size=s,this.pixelRatio=a}async load(){const e=new AbortController;this.state={name:\"loading\",abortController:e};const t=await this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},e.signal);this.state={name:\"loaded\",resources:t}}prepareForRendering(e){if(\"loaded\"!==this.state.name)return void t.error(\"Only loaded resources can be attached.\");const s=this.state.resources;s.prepareForRendering(e),this.state={name:\"attached\",resources:s}}destroy(){if(\"loading\"===this.state.name)return this.state.abortController.abort(),void(this.state={name:\"detached\"});\"attached\"===this.state.name&&(this.state.resources.detach(),this.state={name:\"detached\"})}update(e){if(!this.flowStyle.areResourcesCompatible(e.flowStyle))return!1;return!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio)&&(this.flowStyle=e.flowStyle,!0)}}export{s as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../Graphic.js\";import{HandleOwner as r}from\"../../../../core/HandleOwner.js\";import{watch as i}from\"../../../../core/reactiveUtils.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as o}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{loadImagery as a}from\"./dataUtils.js\";import n from\"./FlowContainer.js\";import l from\"./FlowStrategy.js\";import p from\"./FlowStyle.js\";let h=class extends r{constructor(){super(...arguments),this._loadImagery=(t,e,r,i,s)=>a(this.layer,t,e,r,i,s),this._createStreamlinesMesh=(t,e,r)=>this.layer.createStreamlinesMesh({flowData:e,rendererSettings:t},{signal:r}),this.attached=!1,this.container=null,this.layer=null,this.type=\"flow\",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this._strategy||this._strategy.updating}attach(){const{layer:t}=this,e=()=>{this._loadImagery=(e,r,i,s,o)=>a(t,e,r,i,s,o),this._updateVisualization()};\"multidimensionalDefinition\"in t?this.handles.add(i((()=>t.multidimensionalDefinition),e)):this.handles.add([i((()=>t.mosaicRule),e),i((()=>t.renderingRule),e),i((()=>t.definitionExpression),e)]),this.container=new n,this._strategy=new l({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container.removeAllChildren(),this.container=null,this.handles.removeAll()}update(t){t.stationary?this._strategy.update(t):this.layerView.requestUpdate()}hitTest(t){return new e({attributes:{},geometry:t.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){if(\"flow\"!==this.layer.renderer.type)return;const t=new p(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer,this.timeExtent);this.container.flowStyle=t,this.layerView.requestUpdate()}};t([s()],h.prototype,\"_strategy\",void 0),t([s()],h.prototype,\"attached\",void 0),t([s()],h.prototype,\"container\",void 0),t([s()],h.prototype,\"layer\",void 0),t([s()],h.prototype,\"layerView\",void 0),t([s()],h.prototype,\"type\",void 0),t([s()],h.prototype,\"updating\",null),t([s()],h.prototype,\"timeExtent\",void 0),h=t([o(\"esri.views.2d.engine.flow.FlowView2D\")],h);const d=h;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../../core/maybe.js\";import{throwIfAborted as t}from\"../../../../core/promiseUtils.js\";import r from\"./FlowGLResources.js\";import{createFlowRendererSettings as i}from\"./flowRendererUtils.js\";class n{constructor(e,t,r,n){this._loadImagery=e,this._createStreamlinesMesh=t,this._timeExtent=n,this._rendererSettings=i(r)}get animated(){return this._rendererSettings.lineSpeed>0}get renderSettings(){return this._rendererSettings}areResourcesCompatible(t){let r=!0;return r=r&&t._loadImagery===this._loadImagery,r=r&&t._createStreamlinesMesh===this._createStreamlinesMesh,r=r&&t._rendererSettings.verticesPerLine===this._rendererSettings.verticesPerLine,r=r&&t._rendererSettings.segmentLength===this._rendererSettings.segmentLength,r=r&&t._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing,r=r&&t._rendererSettings.density===this._rendererSettings.density,r=r&&t._rendererSettings.smoothing===this._rendererSettings.smoothing,r=r&&t._rendererSettings.velocityScale===this._rendererSettings.velocityScale,r=r&&t._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold,r=r&&t._rendererSettings.minSpeedThreshold===this._rendererSettings.minSpeedThreshold,r=r&&t._rendererSettings.mergeLines===this._rendererSettings.mergeLines,r=r&&t._rendererSettings.velocityScale===this._rendererSettings.velocityScale,r=r&&t._rendererSettings.interpolate===this._rendererSettings.interpolate,r=r&&t._rendererSettings.lineColor.kind===this._rendererSettings.lineColor.kind,r=r&&t._rendererSettings.lineOpacity.kind===this._rendererSettings.lineOpacity.kind,r=r&&t._rendererSettings.lineRenderWidth.kind===this._rendererSettings.lineRenderWidth.kind,r&&this._rendererSettings.mergeLines&&(r=t._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth),r&&t._timeExtent!==this._timeExtent&&(r=!(!e(t._timeExtent)||!e(this._timeExtent))&&t._timeExtent.equals(this._timeExtent)),r}async loadResources(e,i){const{extent:n,size:s}=e;t(i);const d=await this._loadImagery(n,s[0],s[1],this._timeExtent,i),{vertexData:g,indexData:h}=await this._createStreamlinesMesh(this._rendererSettings,d,i);return new r(g,h,{lineColor:this._rendererSettings.lineColor,lineOpacity:this._rendererSettings.lineOpacity,lineRenderWidth:this._rendererSettings.lineRenderWidth})}}export{n as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{BufferObject as e}from\"../../../webgl/BufferObject.js\";import{DataType as t,Usage as r}from\"../../../webgl/enums.js\";import{VertexArrayObject as s}from\"../../../webgl/VertexArrayObject.js\";import{VertexElementDescriptor as i}from\"../../../webgl/VertexElementDescriptor.js\";const a=new Map;a.set(\"a_positionAndSide\",0),a.set(\"a_timeInfo\",1),a.set(\"a_extrude\",2),a.set(\"a_speed\",3);const n={geometry:[new i(\"a_positionAndSide\",3,t.FLOAT,0,36),new i(\"a_timeInfo\",3,t.FLOAT,12,36),new i(\"a_extrude\",2,t.FLOAT,24,36),new i(\"a_speed\",1,t.FLOAT,32,36)]};class o{constructor(e,t,r){this.values=r,this._vertexData=e,this._indexData=t}prepareForRendering(t){const i=e.createVertex(t,r.STATIC_DRAW,this._vertexData),o=e.createIndex(t,r.STATIC_DRAW,this._indexData),d=new s(t,a,n,{geometry:i},o);this.vertexBuffer=i,this.indexBuffer=o,this.vertexArray=d,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose(),this.vertexBuffer.dispose(),this.indexBuffer.dispose()}get locations(){return a}}export{o as default};\n"],"sourceRoot":"webpack:///"}