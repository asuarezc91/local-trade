{"version":3,"sources":["./node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACuyB,QAAQ,cAAc,oFAAoF,MAAM,gBAAgB,2BAA2B,oEAAC,8EAA8E,sHAAsH,EAAE,MAAM,2EAAC,IAAI,4EAAC,IAAI,QAAQ,mFAAC,IAAI,oEAAoE,EAAE,IAAI,yFAAC,oCAAoC,gFAAC,mBAAmB,6DAAC,0BAA0B,sFAAC,CAAC,0EAAC,CAAC,oFAAC,kDAAkD,gFAAC,uCAAuC,QAAQ,kBAAkB,WAAW,8EAAC,6GAA6G,UAAU,UAAU,MAAM,gEAAgE,gBAAgB,MAAM,qIAAqI,GAAG,wHAAwH,gEAAC,mCAAmC,4EAAC,0BAA0B,4DAAC,EAAE,0GAA0G,6DAAC,EAAE,+BAA+B,EAAE,EAAE,qCAAqC,6DAAC,YAAY,kDAAkD,qCAAqC,mBAAmB,UAAU,sDAAC,iFAAiF,wBAAwB,KAAK,EAAE,qFAAqF,4BAA4B,KAAK,EAAE,6FAA6F,yBAAyB,KAAK,EAAE,2FAA2F,sBAAsB,KAAK,EAAE,8FAA8F,0BAA0B,EAAE,gGAAgG,iBAAiB,MAAM,2FAA2F,wEAAC,8DAA8D,oFAAoF,OAAO,uCAAuC,0EAAC,KAAK,uDAAC,6CAA6C,sDAAC,iFAAiF,QAAQ,GAAG,uCAAuC,qCAAqC,8BAA8B,qDAAqD,IAAI,iCAAiC,OAAO,qCAAqC,0BAA0B,IAAI,MAAM,yFAAC,CAAC,gFAAC,IAAI,MAAM,UAAU,sDAAC,sDAAsD,mBAAmB,IAAyB","file":"layers-graphics-sources-WFSSourceWorker-js.js","sourcesContent":["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\r\n*/\r\nimport e from\"../../../core/Error.js\";import t from\"../../../core/Logger.js\";import{isSome as r,unwrap as s}from\"../../../core/maybe.js\";import{throwIfAborted as a,createTask as i,isAbortError as n}from\"../../../core/promiseUtils.js\";import{equals as o,WGS84 as u}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as p,convertToGeometry as h}from\"../featureConversionUtils.js\";import y from\"../data/FeatureStore.js\";import{project as l,checkProjectionSupport as c}from\"../data/projectionSupport.js\";import m from\"../data/QueryEngine.js\";import{validateGeoJSON as g,createOptimizedFeatures as _}from\"./geojson/geojson.js\";import{mixAttributes as f}from\"./support/sourceUtils.js\";import{getFeature as d}from\"../../ogc/wfsUtils.js\";import w from\"../../support/FieldsIndex.js\";class E{constructor(){this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=async e=>{const{objectIdField:t}=this._queryEngine,s=await d(this._getFeatureUrl,this._featureType.typeName,this._getFeatureOutputFormat,{customParameters:this._customParameters,dateFields:this._queryEngine.fieldsIndex.dateFields.map((e=>e.name)),signal:e});await g(s),a(e);const i=_(s,{geometryType:this._queryEngine.geometryType,hasZ:!1,objectIdField:t});if(!o(this._queryEngine.spatialReference,u))for(const a of i)r(a.geometry)&&(a.geometry=p(l(h(a.geometry,this._queryEngine.geometryType,!1,!1),u,this._queryEngine.spatialReference)));let n=1;for(const r of i){const e={};f(this._fieldsIndex,e,r.attributes,!0),r.attributes=e,null==r.attributes[t]&&(r.objectId=r.attributes[t]=n++)}return i}}destroy(){var e;null==(e=this._queryEngine)||e.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:r,getFeatureOutputFormat:i,spatialReference:n,fields:o,geometryType:u,featureType:p,objectIdField:h,customParameters:l}=e;this._featureType=p,this._customParameters=l,this._getFeatureUrl=r,this._getFeatureOutputFormat=i,this._fieldsIndex=new w(o),await this._checkProjection(n),a(t),this._queryEngine=new m({fields:o,geometryType:u,hasM:!1,hasZ:!1,objectIdField:h,spatialReference:n,timeInfo:null,featureStore:new y({geometryType:u,hasM:!1,hasZ:!1})});const c=await this._snapshotFeatures(s(t.signal));return this._queryEngine.featureStore.addMany(c),{extent:this._queryEngine.fullExtent}}async applyEdits(){throw new e(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(r){var s;return this._customParameters=r,null==(s=this._snapshotTask)||s.abort(),this._snapshotTask=i(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(r=>{this._queryEngine.featureStore.clear(),n(r)||t.getLogger(\"esri.layers.WFSLayer\").error(new e(\"wfs-layer:getfeature-error\",\"An error occurred during the GetFeature request\",{error:r}))})),await this._waitSnapshotComplete(),{extent:this._queryEngine.fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _checkProjection(t){try{await c(u,t)}catch{throw new e(\"unsupported-projection\",\"Projection not supported\",{spatialReference:t})}}}export{E as default};\r\n"],"sourceRoot":"webpack:///"}