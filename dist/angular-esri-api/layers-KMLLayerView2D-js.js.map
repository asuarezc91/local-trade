{"version":3,"sources":["./node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js","./node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js","./node_modules/@arcgis/core/views/2d/layers/KMLLayerView2D.js","./node_modules/@arcgis/core/views/2d/engine/Bitmap.js"],"names":[],"mappings":"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","file":"layers-KMLLayerView2D-js.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{brushes as e}from\"./brushes.js\";import{WGLDrawPhase as r}from\"./webgl/enums.js\";import s from\"./webgl/WGLContainer.js\";class t extends s{get requiresDedicatedFBO(){return this.children.some((e=>\"additive\"===e.blendFunction))}prepareRenderPasses(s){const t=s.registerRenderPass({name:\"bitmap\",brushes:[e.bitmap],target:()=>this.children,drawPhase:r.MAP});return[...super.prepareRenderPasses(s),t]}}export{t as BitmapContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../core/maybe.js\";class i{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return e(this.pixelBlock)?this.pixelBlock.width:0}get height(){return e(this.pixelBlock)?this.pixelBlock.height:0}render(e){const i=this.pixelBlock;if(t(i))return;const l=this.filter({pixelBlock:i});if(t(l.pixelBlock))return;const r=l.pixelBlock.getAsRGBA(),o=e.createImageData(l.pixelBlock.width,l.pixelBlock.height);o.data.set(r),e.putImageData(o,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return t(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{version as i}from\"../../../kernel.js\";import t from\"../../../request.js\";import s from\"../../../core/Collection.js\";import a from\"../../../core/Handles.js\";import{isSome as o,isNone as l}from\"../../../core/maybe.js\";import{watch as r}from\"../../../core/reactiveUtils.js\";import{queryToObject as n,objectToQuery as h}from\"../../../core/urlUtils.js\";import{property as p}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as m}from\"../../../core/accessorSupport/decorators/subclass.js\";import c from\"../../../geometry/Extent.js\";import{load as d,project as y}from\"../../../geometry/projection.js\";import w from\"../../../geometry/SpatialReference.js\";import{canProject as u,project as g}from\"../../../geometry/support/webMercatorUtils.js\";import{getGraphics as _,fetchService as V,parseKML as b}from\"../../../layers/support/kmlUtils.js\";import{parseUrl as f}from\"../../../rest/utils.js\";import{GraphicsCollection as v}from\"../../../support/GraphicsCollection.js\";import{Bitmap as S}from\"../engine/Bitmap.js\";import{BitmapContainer as I}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as C}from\"./LayerView2D.js\";import x from\"./graphics/GraphicContainer.js\";import k from\"./graphics/GraphicsView2D.js\";import j from\"../../layers/LayerView.js\";class P{constructor(){this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]}}let M=class extends(C(j)){constructor(){super(...arguments),this._handles=new a,this._bitmapIndex=new Map,this._mapImageContainer=new I,this._kmlVisualData=new P,this.allVisiblePoints=new v,this.allVisiblePolylines=new v,this.allVisiblePolygons=new v,this.allVisibleMapImages=new s}async hitTest(e,i){var t,s,a;return(await Promise.all([null==(t=this._pointsView)?void 0:t.hitTest(e),null==(s=this._polylinesView)?void 0:s.hitTest(e),null==(a=this._polygonsView)?void 0:a.hitTest(e)])).flat().filter((e=>!!e&&(e.layer=this.layer,e.sourceLayer=this.layer,!0)))}update(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)}attach(){this._fetchController=new AbortController,this.container.addChild(this._mapImageContainer),this._polygonsView=new k({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate(),container:new x(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new k({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate(),container:new x(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new k({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate(),container:new x(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.handles.add([this.allVisibleMapImages.on(\"change\",(e=>{e.added.forEach((e=>this._addMapImage(e))),e.removed.forEach((e=>this._removeMapImage(e)))})),r((()=>this.layer.visibleSublayers),(e=>{for(const[i,t]of this._kmlVisualData.allSublayers)t.visibility=0;for(const i of e){const e=this._kmlVisualData.allSublayers.get(i.id);e&&(e.visibility=1)}this._refreshCollections()}))]),this.updatingHandles.addPromise(this._fetchService(this._fetchController.signal))}detach(){this._fetchController.abort(),this._fetchController=null,this._handles.removeAll(),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null)}moveStart(){}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(e){(this.view.spatialReference.isWGS84||this.view.spatialReference.isWebMercator)&&t(e.href,{responseType:\"image\"}).then((({data:i})=>{let t=c.fromJSON(e.extent);u(t,this.view.spatialReference)&&(t=g(t,this.view.spatialReference));const s=new S(i,\"standard\");s.x=t.xmin,s.y=t.ymax,s.resolution=t.width/i.naturalWidth,s.rotation=e.rotation,this._mapImageContainer.addChild(s),this._bitmapIndex.set(e,s)}))}async _getViewDependentUrl(e,t){const{viewFormat:s,viewBoundScale:a,httpQuery:r}=e;if(o(s)){if(l(t))throw new Error(\"Loading this network link requires a view state.\");let p;if(await d(),o(a)&&1!==a){const e=new c(t.extent);e.expand(a),p=e}else p=t.extent;p=y(p,w.WGS84);const m=y(p,w.WebMercator),u=p.xmin,g=p.xmax,_=p.ymin,V=p.ymax,b=t.size[0]*t.pixelRatio,v=t.size[1]*t.pixelRatio,S=Math.max(m.width,m.height),I={\"[bboxWest]\":u.toString(),\"[bboxEast]\":g.toString(),\"[bboxSouth]\":_.toString(),\"[bboxNorth]\":V.toString(),\"[lookatLon]\":p.center.x.toString(),\"[lookatLat]\":p.center.y.toString(),\"[lookatRange]\":S.toString(),\"[lookatTilt]\":\"0\",\"[lookatHeading]\":t.rotation.toString(),\"[lookatTerrainLon]\":p.center.x.toString(),\"[lookatTerrainLat]\":p.center.y.toString(),\"[lookatTerrainAlt]\":\"0\",\"[cameraLon]\":p.center.x.toString(),\"[cameraLat]\":p.center.y.toString(),\"[cameraAlt]\":S.toString(),\"[horizFov]\":\"60\",\"[vertFov]\":\"60\",\"[horizPixels]\":b.toString(),\"[vertPixels]\":v.toString(),\"[terrainEnabled]\":\"0\",\"[clientVersion]\":i,\"[kmlVersion]\":\"2.2\",\"[clientName]\":\"ArcGIS API for JavaScript\",\"[language]\":\"en-US\"},C=e=>{for(const i in e)for(const t in I)e[i]=e[i].replace(t,I[t])},x=n(s);C(x);let k={};o(r)&&(k=n(r),C(k));const j=f(e.href);j.query={...j.query,...x,...k};return`${j.path}?${h(x)}`}return e.href}async _fetchService(e){const i=new P;await this._loadVisualData(this.layer.url,i,e),this._kmlVisualData=i,this._refreshCollections()}_refreshCollections(){this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e)))}_isSublayerVisible(e){const i=this._kmlVisualData.allSublayers.get(e);return!!i.visibility&&(-1===i.parentFolderId||this._isSublayerVisible(i.parentFolderId))}_loadVisualData(e,i,t){return this._fetchParsedKML(e,t).then((async e=>{for(const s of e.sublayers){i.allSublayers.set(s.id,s);const e=s.points?await _(s.points):[],a=s.polylines?await _(s.polylines):[],o=s.polygons?await _(s.polygons):[],l=s.mapImages||[];if(i.allPoints.push(...e.map((e=>({item:e,sublayerId:s.id})))),i.allPolylines.push(...a.map((e=>({item:e,sublayerId:s.id})))),i.allPolygons.push(...o.map((e=>({item:e,sublayerId:s.id})))),i.allMapImages.push(...l.map((e=>({item:e,sublayerId:s.id})))),s.networkLink){const e=await this._getViewDependentUrl(s.networkLink,this.view.state);await this._loadVisualData(e,i,t)}}}))}_fetchParsedKML(e,i){return V(e,this.view.spatialReference,this.layer.refreshInterval,i).then((e=>b(e.data)))}_removeMapImage(e){const i=this._bitmapIndex.get(e);i&&(this._mapImageContainer.removeChild(i),this._bitmapIndex.delete(e))}};e([p()],M.prototype,\"_pointsView\",void 0),e([p()],M.prototype,\"_polylinesView\",void 0),e([p()],M.prototype,\"_polygonsView\",void 0),e([p()],M.prototype,\"updating\",void 0),M=e([m(\"esri.views.2d.layers.KMLLayerView2D\")],M);const U=M;export{U as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{b as e,c as i,r as s,j as r,m as h}from\"../../../chunks/mat3.js\";import{c as n}from\"../../../chunks/mat3f32.js\";import{f as o}from\"../../../chunks/vec2f32.js\";import{DisplayObject as u}from\"./DisplayObject.js\";import a from\"./ImageryBitmapSource.js\";import{TextureType as d,PixelFormat as c,PixelType as l,TextureWrapMode as _}from\"../../webgl/enums.js\";import{Texture as x}from\"../../webgl/Texture.js\";function m(t){return t&&\"render\"in t}function g(t){return t&&!(\"render\"in t)}function p(t){const e=document.createElement(\"canvas\");return e.width=t.width,e.height=t.height,t.render(e.getContext(\"2d\")),e}function f(t,e,i){const s={target:d.TEXTURE_2D,pixelFormat:c.RGBA,internalFormat:c.RGBA,dataType:l.UNSIGNED_BYTE,wrapMode:_.CLAMP_TO_EDGE};return e&&i&&(s.width=e,s.height=i),new x(t,s)}class v extends u{constructor(t=null,e,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){this._source=t,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:n()}}setTransform(t){const n=e(this.transforms.dvs),[u,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),d=this.resolution/this.pixelRatio/t.resolution,c=d*this.width,l=d*this.height,_=Math.PI*this.rotation/180;i(n,n,o(u,a)),i(n,n,o(c/2,l/2)),s(n,n,-_),i(n,n,o(-c/2,-l/2)),r(n,n,o(c,l)),h(this.transforms.dvs,t.displayViewMat3,n)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,e){this._texture&&t.bindTexture(this._texture,e)}updateTexture(e){var i;if(!this.stage)return null==(i=this._texture)||i.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=f(e,this.sourceWidth,this.sourceHeight):this._texture=f(e));const s=this.source;if(s){if(this._texture.resize(this.sourceWidth,this.sourceHeight),m(s))if(s instanceof a){const e=s.getRenderedRasterPixels();this._texture.setData(t(e)?e.renderedRasterPixels:null)}else this._texture.setData(p(s));else g(s)&&this._texture.setData(s);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}export{v as Bitmap,m as isImageSource,p as rasterize};\n"],"sourceRoot":"webpack:///"}